// Facilities GeoJSON data
const facilitiesData = {
  "type": "FeatureCollection",
  "features": [

    {
      "type": "Feature",
      "properties": {
        "Title": "Apotek Moro Sehat",
        "Descriptio": "Apotek",
        "Kategori": "Kesehatan",
        "Elevation": "536.934359",
        "Latitude": "-7.06783458846171",
        "Longitude": "109.833512440622",
        "Image": "fasum/apotekmorosehat.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.833512440622, -7.06783458846171]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "Apotek Al Aieza",
        "Descriptio": "Apotek",
        "Kategori": "Kesehatan",
        "Elevation": "537.654492",
        "Latitude": "-7.0685137550777",
        "Longitude": "109.834214653834",
        "Image": "fasum/apotekaieza.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.83412210372839, -7.068508652483597]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "Apotek Enggal Sehat",
        "Descriptio": "Apotek",
        "Kategori": "Kesehatan",
        "Elevation": "544.287143",
        "Latitude": "-7.07079084682167",
        "Longitude": "109.833567105008",
        "Image": "fasum/apotekenggal.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.833567105008, -7.07079084682167]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "Balai Desa Blado",
        "Descriptio": "Kantor Desa",
        "Kategori": "Pemerintahan",
        "Elevation": "546.731749",
        "Latitude": "-7.07113736150534",
        "Longitude": "109.834026634478",
        "Image": "fasum/balaidesa.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.834026634478, -7.07113736150534]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "Koramil 09 Blado",
        "Descriptio": "Koramil",
        "Kategori": "Pemerintahan",
        "Elevation": "538.053296",
        "Latitude": "-7.06918716515978",
        "Longitude": "109.83396605038",
        "Image": "fasum/koramil.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.83396605038, -7.06918716515978]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "KPRI Lestari",
        "Descriptio": "Koperasi",
        "Kategori": "Ekonomi",
        "Elevation": "539.0",
        "Latitude": "-7.06883363634211",
        "Longitude": "109.833613138266",
        "Image": "fasum/kpri.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.833613138266, -7.06883363634211]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "Masjid Al Ikhlas",
        "Descriptio": "Masjid",
        "Kategori": "Tempat Ibadah",
        "Elevation": "549.266933",
        "Latitude": "-7.07259753164102",
        "Longitude": "109.835289469522",
        "Image": "fasum/masjidalikhlas.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.835289469522, -7.07259753164102]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "Masjid Desa Bandusari",
        "Descriptio": "Masjid",
        "Kategori": "Tempat Ibadah",
        "Elevation": "537.511228",
        "Latitude": "-7.06755467484375",
        "Longitude": "109.833447751678",
        "Image": "fasum/masjidbandu.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.833447751678, -7.06755467484375]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "Masjid Nurul Huda",
        "Descriptio": "Masjid",
        "Kategori": "Tempat Ibadah",
        "Elevation": "584.395408",
        "Latitude": "-7.07730848112274",
        "Longitude": "109.833031978973",
        "Image": "fasum/masjidnurul.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.833031978973, -7.07730848112274]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "Pasar Blado",
        "Descriptio": "Pasar",
        "Kategori": "Ekonomi",
        "Elevation": "539.341205",
        "Latitude": "-7.06901711584934",
        "Longitude": "109.833405791454",
        "Image": "fasum/pasar.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.833405791454, -7.06901711584934]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "Polsek Blado",
        "Descriptio": "Kantor Polisi",
        "Kategori": "Pemerintahan",
        "Elevation": "554.334527",
        "Latitude": "-7.07188273183192",
        "Longitude": "109.83388952883",
        "Image": "fasum/polsekblado.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.83388952883, -7.07188273183192]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "Puskesmas Blado",
        "Descriptio": "Puskesmas",
        "Kategori": "Kesehatan",
        "Elevation": "539.075144",
        "Latitude": "-7.06953653446004",
        "Longitude": "109.83396010556",
        "Image": "fasum/puskesmas.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.83396010556, -7.06953653446004]
      }
    },

        {
      "type": "Feature",
      "properties": {
        "Title": "Masjid Al Ishlah (YAMP)",
        "Descriptio": "Masjid",
        "Kategori": "Tempat Ibadah",
        "Elevation": "549.132359",
        "Latitude": "-7.07155379809381",
        "Longitude": "109.833499000395",
        "Image": "fasum/masjidyamp.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.833499000395, -7.07155379809381]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "Masjid Sabiilunnajaah",
        "Descriptio": "Masjid",
        "Kategori": "Tempat Ibadah",
        "Elevation": "528.982742",
        "Latitude": "-7.06695483806874",
        "Longitude": "109.828318693663",
        "Image": "fasum/masjidsabil.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.828318693663, -7.06695483806874]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "Masjid Roudhotu Tholibin",
        "Descriptio": "Masjid",
        "Kategori": "Tempat Ibadah",
        "Elevation": "556.565718",
        "Latitude": "-7.0754614591903",
        "Longitude": "109.826258769907",
        "Image": "fasum/rhoudotu.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.826258769907, -7.0754614591903]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "SD N Blado 1",
        "Descriptio": "Sekolah",
        "Kategori": "SD",
        "Elevation": "541.456671",
        "Latitude": "-7.06987410061882",
        "Longitude": "109.833939893271",
        "Image": "fasum/sd1.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.833939893271, -7.06987410061882]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "SD Blado 2",
        "Descriptio": "Sekolah",
        "Kategori": "SD",
        "Elevation": "557.813951",
        "Latitude": "-7.075654941352",
        "Longitude": "109.828227001229",
        "Image": "fasum/sd2.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.828227001229, -7.075654941352]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "SMP N 1 Blado",
        "Descriptio": "Sekolah",
        "Kategori": "SMP",
        "Elevation": "544.441110",
        "Latitude": "-7.07047922288412",
        "Longitude": "109.834275483945",
        "Image": "fasum/smp1.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.834275483945, -7.07047922288412]
      }
    },

    {
      "type": "Feature",
      "properties": {
        "Title": "TK Mardu Siwi",
        "Descriptio": "Sekolah",
        "Kategori": "TK",
        "Elevation": "540.857940",
        "Latitude": "-7.07046537590927",
        "Longitude": "109.83539932839",
        "Image": "fasum/tk.jpeg"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [109.83539932839, -7.07046537590927]
      }
    },
    {
  "type": "Feature",
  "properties": {
    "Title": "Bank BRI Unit Blado",
    "Descriptio": "Bank",
    "Kategori": "Ekonomi",
    "Elevation": "537.175106",
    "Latitude": "-7.06855152471231",
    "Longitude": "109.834281235287",
    "Image": null
  },
  "geometry": {
    "type": "Point",
    "coordinates": [109.834281235287, -7.06855152471231]
  }
},

{
  "type": "Feature",
  "properties": {
    "Title": "Gereja GPDI Elim Blado",
    "Descriptio": "Gereja",
    "Kategori": "Tempat Ibadah",
    "Elevation": "523.706049",
    "Latitude": "-7.06810318259595",
    "Longitude": "109.835931883527",
    "Image": null
  },
  "geometry": {
    "type": "Point",
    "coordinates": [109.835931883527, -7.06810318259595]
  }
},

{
  "type": "Feature",
  "properties": {
    "Title": "Kantor Kecamatan Blado",
    "Descriptio": "Kantor Kecamatan",
    "Kategori": "Pemerintahan",
    "Elevation": "537.509014",
    "Latitude": "-7.06804126912288",
    "Longitude": "109.834234859106",
    "Image": null
  },
  "geometry": {
    "type": "Point",
    "coordinates": [109.834234859106, -7.06804126912288]
  }
},

{
  "type": "Feature",
  "properties": {
    "Title": "Madrasah Diniyah Al Hidayah",
    "Descriptio": "Sekolah",
    "Kategori": "Pendidikan",
    "Elevation": "546.292666",
    "Latitude": "-7.07053597635119",
    "Longitude": "109.833027120723",
    "Image": null
  },
  "geometry": {
    "type": "Point",
    "coordinates": [109.833027120723, -7.07053597635119]
  }
},

{
  "type": "Feature",
  "properties": {
    "Title": "PKBM Hati Mulya",
    "Descriptio": "PKBM",
    "Kategori": "Pendidikan",
    "Elevation": "554.728153",
    "Latitude": "-7.07240417042196",
    "Longitude": "109.83431732466",
    "Image": null
  },
  "geometry": {
    "type": "Point",
    "coordinates": [109.83431732466, -7.07240417042196]
  }
},

{
  "type": "Feature",
  "properties": {
    "Title": "PAUD Mekar Asri",
    "Descriptio": "Sekolah",
    "Kategori": "PAUD",
    "Elevation": "505.460953",
    "Latitude": "-7.06430660060858",
    "Longitude": "109.8280273807",
    "Image": null
  },
  "geometry": {
    "type": "Point",
    "coordinates": [109.8280273807, -7.06430660060858]
  }
},

{
  "type": "Feature",
  "properties": {
    "Title": "TPA An Nadhliyah",
    "Descriptio": null,
    "Kategori": "Pendidikan",
    "Elevation": "555.531235",
    "Latitude": "-7.07545740666041",
    "Longitude": "109.826139192621",
    "Image": null
  },
  "geometry": {
    "type": "Point",
    "coordinates": [109.826139192621, -7.07545740666041]
  }
},

{
  "type": "Feature",
  "properties": {
    "Title": "Terminal Blado",
    "Descriptio": null,
    "Kategori": null,
    "Elevation": "536.650045",
    "Latitude": "-7.06851390132545",
    "Longitude": "109.833302102733",
    "Image": null
  },
  "geometry": {
    "type": "Point",
    "coordinates": [109.833302102733, -7.06851390132545]
  }
},

{
  "type": "Feature",
  "properties": {
    "Title": "UPT Disdikpora Kecamatan Blado",
    "Descriptio": "Disdikpora",
    "Kategori": "Pemerintahan",
    "Elevation": "546.071407",
    "Latitude": "-7.07101579093728",
    "Longitude": "109.83400404436",
    "Image": null
  },
  "geometry": {
    "type": "Point",
    "coordinates": [109.83400404436, -7.07101579093728]
  }
},

{
  "type": "Feature",
  "properties": {
    "Title": "SD N Blado 3",
    "Descriptio": "Sekolah",
    "Kategori": "SD",
    "Elevation": "543.641183",
    "Latitude": "-7.06715230109544",
    "Longitude": "109.834184774205",
    "Image": null
  },
  "geometry": {
    "type": "Point",
    "coordinates": [109.834184774205, -7.06715230109544]
  }
}
  ]
};

// Health Facilities GeoJSON data
const healthFacilitiesData = {
  "type": "FeatureCollection",
  "name": "Faskes",
  "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
  "features": [
    { "type": "Feature", "properties": { "Title": "Apotek Moro Sehat", "Latitude": "-7.06783458846171", "Longitude": "109.833512440622", "Descriptio": "Apotek","Image": "faskes/apotekmorosehat.jpeg"}, "geometry": { "type": "Point", "coordinates": [ 109.833512440622002, -7.06783458846171 ] } },
    { "type": "Feature", "properties": { "Title": "Apotek Ada Market", "Latitude": "-7.06824644847819", "Longitude": "109.831891448716", "Descriptio": "Apotek","Image": "fasum/apotekbladosehat.jpeg" }, "geometry": { "type": "Point", "coordinates": [ 109.831891448715993, -7.06824644847819 ] } },
    { "type": "Feature", "properties": { "Title": "Apotek Al Aieza", "Latitude": "-7.0685137550777", "Longitude": "109.834214653834", "Descriptio": "Apotek","Image": "fasum/apotekaieza.jpeg" }, "geometry": { "type": "Point", "coordinates": [ 109.83412210372839, -7.068508652483597 ] } },
    { "type": "Feature", "properties": { "Title": "Apotek Enggal Sehat", "Latitude": "-7.07079084682167", "Longitude": "109.833567105008", "Descriptio": "Apotek","Image": "faskes/apotekenggal.jpeg" }, "geometry": { "type": "Point", "coordinates": [ 109.833567105008001, -7.07079084682167 ] } },
    { "type": "Feature", "properties": { "Title": "Puskesmas Blado 1", "Latitude": "-7.06953653446004", "Longitude": "109.83396010556", "Descriptio": "Puskesmas","Image": "faskes/puskesmas.jpeg" }, "geometry": { "type": "Point", "coordinates": [ 109.833960105559996, -7.06953653446004 ] } },
    { "type": "Feature", "properties": { "Title": "Praktik Bidan Dwi Asih W", "Latitude": "-7.07138870685468", "Longitude": "109.833116779677", "Descriptio": "Praktik Bidan","Image": "faskes/bidanasih.jpeg" }, "geometry": { "type": "Point", "coordinates": [ 109.833116779676999, -7.07138870685468 ] } },
    { "type": "Feature", "properties": { "Title": "Praktik Bidan Dwi Puning", "Latitude": "-7.07073243807813", "Longitude": "109.833299034607", "Descriptio": "Praktik Bidan","Image": "faskes/bidanpuning.jpeg" }, "geometry": { "type": "Point", "coordinates": [ 109.833299034606995, -7.07073243807813 ] } },
    { "type": "Feature", "properties": { "Title": "Praktik Dokter Dian Putri", "Latitude": "-7.06687759979002", "Longitude": "109.833492213282", "Descriptio": "Praktik Dokter" ,"Image": "faskes/dokdian.jpeg"}, "geometry": { "type": "Point", "coordinates": [ 109.833492213282, -7.06687759979002 ] } }
  ]
};

// Boundaries GeoJSON data
const boundariesData = {"type":"FeatureCollection","name":"Batas Padukuhan","crs":{"type":"name","properties":{"name":"urn:ogc:def:crs:OGC:1.3:CRS84"}},"features":[{"type":"Feature","properties":{"id":null,"Nama":"Bandusari"},"geometry":{"type":"MultiPolygon","coordinates":[[[[109.829660178533715,-7.068985558287046],[109.830023350586742,-7.068882646187444],[109.830282578339606,-7.068759864257962],[109.830394517596531,-7.068783251294663],[109.83070676920795,-7.068713090181006],[109.831019020819397,-7.068847565639492],[109.831608174803236,-7.06802901876453],[109.831726005600004,-7.067964704305774],[109.831885077175627,-7.067613898009523],[109.832892530487982,-7.067385873774157],[109.832723,-7.065582],[109.834448,-7.065490000999965],[109.835001,-7.065413],[109.836291,-7.065586],[109.836441,-7.065519],[109.836562,-7.06536],[109.83676,-7.065346],[109.836944,-7.065374],[109.837132,-7.065419],[109.837334999000063,-7.065539],[109.837582,-7.065761],[109.837873,-7.066078],[109.839606864094023,-7.068458988519397],[109.836188391454627,-7.069416716670726],[109.836144648677617,-7.069394391406744],[109.836094656932445,-7.069417956963139],[109.835970444807629,-7.06951259231588],[109.835636794875924,-7.069721695380816],[109.835503853629049,-7.069803181865205],[109.835391765911083,-7.069911830488699],[109.835296894131574,-7.069970804392685],[109.835239551379146,-7.070146944304304],[109.835163533659141,-7.070251836138978],[109.834548707742712,-7.070228239625477],[109.833729525565104,-7.070211980562386],[109.833735889347651,-7.069917803819319],[109.830459310977943,-7.069907381814242],[109.830401,-7.069729],[109.830264,-7.069492],[109.830076001000023,-7.069279],[109.829945544650698,-7.069175392715517],[109.829660178533715,-7.068985558287046]]]]}},{"type":"Feature","properties":{"id":null,"Nama":"Sembir Banyuanyar"},"geometry":{"type":"MultiPolygon","coordinates":[[[[109.8296601785337,-7.068985558287046],[109.828951999000125,-7.068639],[109.827395534435979,-7.068050549797634],[109.825143001000086,-7.067414],[109.823575249000029,-7.066515226999961],[109.823554,-7.066288],[109.823287,-7.065668],[109.822849999000056,-7.065329101999965],[109.822181,-7.064708],[109.822678,-7.064537998999978],[109.824258,-7.063672],[109.825118,-7.063378],[109.825853,-7.063477],[109.827192686000018,-7.063219164],[109.827247,-7.06359],[109.82731118600006,-7.063788600999957],[109.827413999000058,-7.063913998999951],[109.827577249000058,-7.06401297699996],[109.827837811000038,-7.064067601999949],[109.827933061000081,-7.064068601999943],[109.827982124000059,-7.064051850999889],[109.828335873000015,-7.063773038999914],[109.828700811000019,-7.063684226999937],[109.829318561000051,-7.06371635199993],[109.829510686000063,-7.063778789999946],[109.829637311000056,-7.063909788999949],[109.829922061000076,-7.064443414999959],[109.829976998000092,-7.064569288999983],[109.830026998000065,-7.064617101999941],[109.830158634028379,-7.065045068527491],[109.830274249000084,-7.065529163999912],[109.831098,-7.065633999999888],[109.832723,-7.065582],[109.832892530487982,-7.067385873774157],[109.831885077175627,-7.067613898009522],[109.831726005600004,-7.067964704305774],[109.831608174803236,-7.06802901876453],[109.831019020819397,-7.068847565639492],[109.83070676920795,-7.068713090181006],[109.830394517596531,-7.068783251294663],[109.830282578339606,-7.068759864257962],[109.830023350586742,-7.068882646187444],[109.8296601785337,-7.068985558287046]]]]}},{"type":"Feature","properties":{"id":null,"Nama":"Blado"},"geometry":{"type":"MultiPolygon","coordinates":[[[[109.830523,-7.070828],[109.830547999000103,-7.070335],[109.830512,-7.070054],[109.830459310977929,-7.069907381814242],[109.833735889347651,-7.069917803819319],[109.833729525565104,-7.070211980562386],[109.835163533659141,-7.070251836138978],[109.835239551379146,-7.070146944304304],[109.835296894131574,-7.069970804392685],[109.835391765911083,-7.069911830488699],[109.835503853629049,-7.069803181865205],[109.836094656932445,-7.069417956963139],[109.836144648677617,-7.069394391406744],[109.836188391454627,-7.069416716670726],[109.839606864094023,-7.068458988519397],[109.84099,-7.070332],[109.840059,-7.071204000999966],[109.839809001000049,-7.07126000099989],[109.838854561,-7.071220788999925],[109.838575624000043,-7.071317100999988],[109.838116,-7.071593],[109.838039873000014,-7.071737101999924],[109.83799724900004,-7.072015038999916],[109.838056,-7.072823],[109.838017311000016,-7.073073601999927],[109.837941311000051,-7.07314954],[109.837793998,-7.073217289999914],[109.837687798938774,-7.07320480657116],[109.836977499000056,-7.073127350999934],[109.83685674900002,-7.073174851999956],[109.836798,-7.0733],[109.836716061000089,-7.073604976999929],[109.836635,-7.073743],[109.836538000000118,-7.073984],[109.836683999,-7.074620726999949],[109.836598374000047,-7.074735913999977],[109.836414,-7.074836],[109.835950999000048,-7.074934],[109.835586248000055,-7.075046038999969],[109.835280124000036,-7.07521379],[109.835253936000072,-7.075408913999973],[109.835281436000045,-7.075698663999967],[109.835260498000082,-7.075937976999961],[109.835117186000048,-7.076203663999916],[109.834981498,-7.076231601999919],[109.834894059000064,-7.076232035999956],[109.834133995841043,-7.074430063268769],[109.830594632954785,-7.072760721820518],[109.83004399900004,-7.072426],[109.830246113898681,-7.072171301045544],[109.830341307920108,-7.07197167920622],[109.830469103514545,-7.071173764090619],[109.830523,-7.070828]]]]}},{"type":"Feature","properties":{"id":null,"Nama":"Grogol"},"geometry":{"type":"MultiPolygon","coordinates":[[[[109.834894059000064,-7.076232035999956],[109.834631,-7.076262],[109.834465811000072,-7.076411101999939],[109.834409,-7.076761],[109.834485999000037,-7.077025288999953],[109.834664123000039,-7.077362538999969],[109.83493043600005,-7.07765035199998],[109.835402999000081,-7.078045000999958],[109.835533,-7.078485],[109.835581,-7.078897],[109.835477124000064,-7.079246601999982],[109.835399001000013,-7.07935],[109.835391123000065,-7.079783913999941],[109.835889436000087,-7.08015197699993],[109.8359068110001,-7.080259539999948],[109.83579787400005,-7.080419038999911],[109.835266499000056,-7.080808163999956],[109.834941498,-7.081490475999922],[109.8342,-7.081797],[109.83372,-7.082096],[109.833181,-7.082333000999919],[109.832964,-7.082392],[109.832353,-7.082186998999919],[109.831681657658848,-7.081410762405642],[109.830775625481778,-7.080256768795281],[109.830367108281592,-7.07965897217941],[109.83016563349419,-7.079389851529353],[109.8302334360001,-7.079284351],[109.830211277759219,-7.078755638604583],[109.830182811000086,-7.078371976],[109.830017311000049,-7.077774913999983],[109.829553561000054,-7.077505413999977],[109.829523749000074,-7.077472225999983],[109.829238569066703,-7.077161767579654],[109.828805998000021,-7.076639976999958],[109.83123874735179,-7.073991172917445],[109.831176034388164,-7.073905598974644],[109.831939463288705,-7.073393931810052],[109.834133995841043,-7.074430063268769],[109.834894059000064,-7.076232035999956]]]]}},{"type":"Feature","properties":{"id":null,"Nama":"Kepokoh"},"geometry":{"type":"MultiPolygon","coordinates":[[[[109.83016563349419,-7.079389851529352],[109.830199999000072,-7.079434000999951],[109.830028,-7.079236001],[109.829652788498692,-7.078974560299466],[109.829499,-7.078878],[109.829239999000066,-7.078791],[109.828981,-7.078753],[109.827919,-7.079034],[109.823919,-7.08091],[109.822277373000034,-7.081656852000011],[109.821799999000049,-7.081079664999948],[109.821450873000046,-7.080769789999978],[109.820580873,-7.08037047599989],[109.820602186000073,-7.079701852],[109.820391248000121,-7.079084288999963],[109.819701,-7.078392],[109.819531499000021,-7.077574538999923],[109.819582001000029,-7.077112],[109.820034,-7.07627799899995],[109.823103897881438,-7.074260329068153],[109.823676,-7.074048000999911],[109.824264,-7.073811],[109.825092,-7.073562000999935],[109.825907,-7.073372],[109.826734,-7.073243],[109.828125,-7.073042999999891],[109.829372,-7.072807],[109.8296,-7.072736],[109.829876,-7.07259299899996],[109.83004399900004,-7.072426],[109.830594632954785,-7.072760721820517],[109.831939463288705,-7.073393931810052],[109.831176034388164,-7.073905598974644],[109.83123874735179,-7.073991172917445],[109.828805998000021,-7.076639976999958],[109.829553561000054,-7.077505413999975],[109.830017311000034,-7.077774913999983],[109.830182811000071,-7.078371976],[109.8302334360001,-7.079284351],[109.83016563349419,-7.079389851529352]]]]}}]};

// Global variables
let map;
let markers = [];
let markersLayer;
let boundariesLayer;

// Category colors
const categoryColors = {
    'Kesehatan': '#e74c3c',
    'Pendidikan': '#3498db',
    'Pemerintahan': '#9b59b6',
    'Ekonomi': '#f39c12',
    'Tempat Ibadah': '#27ae60',
    'SD': '#16a085',
    'SMP': '#2980b9',
    'TK': '#8e44ad',
    'PAUD': '#c0392b'
};

// Padukuhan colors
const padukuhanColors = {
    'Bandusari': 'rgba(255, 0, 0, 0.3)',
    'Sembir Banyuanyar': 'rgba(0, 255, 0, 0.3)',
    'Blado': 'rgba(0, 0, 255, 0.3)',
    'Grogol': 'rgba(255, 255, 0, 0.3)',
    'Kepokoh': 'rgba(255, 0, 255, 0.3)'
};

// Health facility colors
const healthCategoryColors = {
    'Apotek': '#e74c3c',
    'Puskesmas': '#3498db',
    'Praktik Bidan': '#9b59b6',
    'Praktik Dokter': '#27ae60'
};

let healthMarkers = [];

// Create custom marker icon
function getMarkerIcon(category) {
    const color = categoryColors[category] || '#95a5a6';
    return L.divIcon({
        className: 'custom-marker',
        html: `<div style="background-color: ${color}; width: 25px; height: 25px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>`,
        iconSize: [25, 25],
        iconAnchor: [12, 12]
    });
}

// Create popup content
function createPopupContent(properties) {
    const kategori = properties.Kategori || 'Lainnya';
    const catClass = 'cat-' + kategori.toLowerCase().replace(/\s+/g, '-');
    const elevasi = properties.Elevation
        ? parseFloat(properties.Elevation).toFixed(2) + ' m'
        : '-';
    const deskripsi = properties.Descriptio || '-';

    const imagePath = properties.Image
        ? `images/${properties.Image}`
        : null;

    return `
        <div class="popup-card">
            ${imagePath ? `
                <img 
                    src="${imagePath}" 
                    class="popup-image"
                    onerror="this.style.display='none'"
                >
            ` : ''}

            <div class="popup-title">${properties.Title}</div>

            <div class="popup-info">
                <strong>Kategori:</strong>
                <span class="category-badge ${catClass}">${kategori}</span>
            </div>

            <div class="popup-info"><strong>Deskripsi:</strong> ${deskripsi}</div>
            <div class="popup-info"><strong>Elevasi:</strong> ${elevasi}</div>
            <div class="popup-info">
                <strong>Koordinat:</strong>
                ${properties.Latitude}, ${properties.Longitude}
            </div>
        </div>
    `;
}

// Create popup content for health facilities
function createHealthPopupContent(properties) {
    const deskripsi = properties.Descriptio || '-';
    const catClass = 'cat-' + deskripsi.toLowerCase().replace(/\s+/g, '-');

    const imagePath = properties.Image
        ? `images/${properties.Image}`
        : null;

    return `
        <div class="popup-card">
            ${imagePath ? `
                <img 
                    src="${imagePath}" 
                    class="popup-image"
                    onerror="this.style.display='none'"
                >
            ` : ''}

            <div class="popup-title">${properties.Title}</div>

            <div class="popup-info">
                <strong>Jenis:</strong>
                <span class="category-badge ${catClass}">${deskripsi}</span>
            </div>

            <div class="popup-info">
                <strong>Koordinat:</strong>
                ${properties.Latitude}, ${properties.Longitude}
            </div>
        </div>
    `;
}


// Add markers to map
function addMarkers() {
    markersLayer.clearLayers();
    markers = [];
    facilitiesData.features.forEach(feature => {
        const props = feature.properties;
        const coords = feature.geometry.coordinates;
        const kategori = props.Kategori || 'Lainnya';
        const marker = L.marker([coords[1], coords[0]], {
            icon: getMarkerIcon(kategori)
        }).bindPopup(createPopupContent(props));
        marker.properties = props;
        marker.addTo(markersLayer);
        markers.push(marker);
    });
}

// Add health markers to map
function addHealthMarkers() {
    healthMarkersLayer.clearLayers();
    healthMarkers = [];

    healthFacilitiesData.features.forEach(feature => {
        const props = feature.properties;
        const coords = feature.geometry.coordinates;
        const kategori = props.Descriptio || 'Lainnya';
        const color = healthCategoryColors[kategori] || '#95a5a6';

        const marker = L.marker([coords[1], coords[0]], {
            icon: L.divIcon({
                className: 'custom-marker',
                html: `<div style="
                    background-color:${color};
                    width:25px;
                    height:25px;
                    border-radius:50%;
                    border:3px solid white;
                    box-shadow:0 2px 5px rgba(0,0,0,0.3);
                "></div>`,
                iconSize: [25, 25],
                iconAnchor: [12, 12]
            })
        }).bindPopup(createHealthPopupContent(props), {
            autoPan: true,
            keepInView: true,
            autoPanPadding: [30, 30],
            offset: [0, -10],
            closeButton: true
        });

        marker.properties = props;
        marker.addTo(healthMarkersLayer);
        healthMarkers.push(marker);
    });
}


// Add boundaries to map
function addBoundaries() {
    boundariesLayer.clearLayers();
    
    window.boundariesGeoJSON = L.geoJSON(boundariesData, {
        style: function(feature) {
            const nama = feature.properties.Nama;
            return {
                fillColor: padukuhanColors[nama] || 'rgba(128, 128, 128, 0.3)',
                weight: 2,
                opacity: 0.8,
                color: '#333',
                fillOpacity: 0.15  // Default: tipis untuk tab non-administrasi
            };
        },
        onEachFeature: function(feature, layer) {
            const nama = feature.properties.Nama;
            layer.bindPopup(`<div class="popup-title">Padukuhan ${nama}</div>`);
            
            // Highlight on hover
            layer.on('mouseover', function() {
                const currentFillOpacity = this.options.fillOpacity;
                this.setStyle({
                    weight: 3,
                    fillOpacity: Math.min(currentFillOpacity + 0.2, 1)
                });
            });
            
            layer.on('mouseout', function() {
                // Cek tab yang aktif untuk mengembalikan opacity yang sesuai
                const isAdminTab = document.querySelector('[data-tab="administrasi"]').classList.contains('active');
                this.setStyle({
                    weight: 2,
                    fillOpacity: isAdminTab ? 0.4 : 0.15
                });
            });
        }
    }).addTo(boundariesLayer);
}

// Filter markers by category
function filterMarkers() {
    const checkboxes = document.querySelectorAll('.category-check:checked');
    const selectedCategories = Array.from(checkboxes).map(cb => cb.value);
    markersLayer.clearLayers();
    let visibleCount = 0;
    markers.forEach(marker => {
        const kategori = marker.properties.Kategori || 'Lainnya';
        if (selectedCategories.includes(kategori)) {
            marker.addTo(markersLayer);
            visibleCount++;
        }
    });
    document.getElementById('visibleFacilities').textContent = visibleCount;
}

// Filter health markers by category
function filterHealthMarkers() {
    const checkboxes = document.querySelectorAll('.health-category-check:checked');
    const selectedCategories = Array.from(checkboxes).map(cb => cb.value);
    healthMarkersLayer.clearLayers();
    healthMarkers.forEach(marker => {
        const kategori = marker.properties.Descriptio || 'Lainnya';
        if (selectedCategories.includes(kategori)) {
            marker.addTo(healthMarkersLayer);
        }
    });
}

// Toggle all categories
function toggleAll(checkbox) {
    const categoryChecks = document.querySelectorAll('.category-check');
    categoryChecks.forEach(cb => cb.checked = checkbox.checked);
    filterMarkers();
}

// Toggle all health categories
function toggleAllHealth(checkbox) {
    const categoryChecks = document.querySelectorAll('.health-category-check');
    categoryChecks.forEach(cb => cb.checked = checkbox.checked);
    filterHealthMarkers();
}

// Initialize map
document.addEventListener('DOMContentLoaded', function() {
    // Define bounds for Desa Blado area (southwest and northeast corners)
    // Area ini mencakup seluruh wilayah Desa Blado dengan buffer kecil
    const bladoBounds = [
        [-7.092, 109.810],  // Southwest corner (Batas Bawah Kiri)
        [-7.052, 109.852]   // Northeast corner (Batas Atas Kanan)
    ];
    
    // Create map centered on Desa Blado with bounds restriction
    map = L.map('map', {
        maxBounds: bladoBounds,
        maxBoundsViscosity: 0.8,  // Membuat bounds terasa lebih "kenyal"
        minZoom: 14,               // Zoom minimum agar tidak terlalu jauh
        maxZoom: 20,               // Zoom maksimum untuk detail
        zoomControl: false         // Disable zoom control buttons
    }).setView([-7.070288, 109.83581], 14);
    
    // Add tile layer
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '© OpenStreetMap contributors © CARTO',
        subdomains: 'abcd',
        maxZoom: 20
    }).addTo(map);
    
    // Initialize layers
    markersLayer = L.layerGroup().addTo(map);
    healthMarkersLayer = L.layerGroup().addTo(map);
    boundariesLayer = L.layerGroup().addTo(map);
    
    // Add data to map
    addMarkers();
    addHealthMarkers();
    addBoundaries();
    
    // Fit bounds to markers
    if (markers.length > 0) {
        const group = L.featureGroup(markers);
        map.fitBounds(group.getBounds().pad(0.1));
    }
    
    // Event listeners
    document.getElementById('checkAll').addEventListener('change', function() {
        toggleAll(this);
    });
    document.querySelectorAll('.category-check').forEach(checkbox => {
        checkbox.addEventListener('change', filterMarkers);
    });
    
    // Health facilities event listeners
    document.getElementById('checkAllHealth').addEventListener('change', function() {
        toggleAllHealth(this);
    });
    document.querySelectorAll('.health-category-check').forEach(checkbox => {
        checkbox.addEventListener('change', filterHealthMarkers);
    });
    
    // Fullscreen functionality
    document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);
    
    // Tab switching functionality (panel tabs)
    document.querySelectorAll('.panel-tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            switchTab(this.dataset.tab);
        });
    });
    
    // Initialize with administrasi tab active and proper boundary opacity
    switchTab('administrasi');
});

// Fullscreen toggle function
function toggleFullscreen() {
    const mapWrapper = document.querySelector('.map-wrapper');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const icon = fullscreenBtn.querySelector('.fullscreen-icon');
    
    if (!mapWrapper.classList.contains('fullscreen')) {
        // Enter fullscreen
        mapWrapper.classList.add('fullscreen');
        icon.textContent = '✕';
        
        // Invalidate map size to adjust to new container size
        setTimeout(() => {
            map.invalidateSize();
        }, 100);
    } else {
        // Exit fullscreen
        mapWrapper.classList.remove('fullscreen');
        icon.textContent = '⛶';
        
        // Invalidate map size to adjust back
        setTimeout(() => {
            map.invalidateSize();
        }, 100);
    }
}

// ESC key to exit fullscreen
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const mapWrapper = document.querySelector('.map-wrapper');
        if (mapWrapper.classList.contains('fullscreen')) {
            toggleFullscreen();
        }
    }
});

// ============================================
// MOBILE MENU TOGGLE
// ============================================
(function initMobileMenu() {
    const menuToggle = document.getElementById('menuToggle');
    const navMenu = document.getElementById('navMenu');
    
    if (!menuToggle || !navMenu) return;
    
    // Toggle menu on hamburger click
    menuToggle.addEventListener('click', function() {
        this.classList.toggle('active');
        navMenu.classList.toggle('active');
    });
    
    // Close menu when clicking on a link
    const navLinks = navMenu.querySelectorAll('a');
    navLinks.forEach(link => {
        link.addEventListener('click', () => {
            menuToggle.classList.remove('active');
            navMenu.classList.remove('active');
        });
    });
    
    // Close menu when clicking outside
    document.addEventListener('click', function(event) {
        const isClickInsideMenu = navMenu.contains(event.target);
        const isClickOnToggle = menuToggle.contains(event.target);
        
        if (!isClickInsideMenu && !isClickOnToggle && navMenu.classList.contains('active')) {
            menuToggle.classList.remove('active');
            navMenu.classList.remove('active');
        }
    });
})();

// ============================================
// MOBILE PANEL TOGGLE (Collapse/Expand)
// ============================================
(function initPanelToggle() {
    const mapPanel = document.getElementById('infoPanel');
    const toggleBtn = document.getElementById('panelToggleBtn');
    
    if (!mapPanel || !toggleBtn) return;
    
    const toggleText = toggleBtn.querySelector('.toggle-text');
    
    // Function to update toggle button icon
    function updateToggleIcon() {
        if (!toggleText) return;
        
        if (mapPanel.classList.contains('collapsed')) {
            toggleText.textContent = '☰'; // Menu/hamburger icon when collapsed
            toggleBtn.setAttribute('title', 'Buka Panel');
        } else {
            toggleText.textContent = '✕'; // X icon when expanded
            toggleBtn.setAttribute('title', 'Tutup Panel');
        }
    }
    
    // Set initial state to collapsed on mobile
    if (window.innerWidth <= 768) {
        mapPanel.classList.add('collapsed');
        updateToggleIcon();
    }
    
    // Toggle panel when clicking the button
    toggleBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        e.preventDefault();
        mapPanel.classList.toggle('collapsed');
        updateToggleIcon();
        
        // Invalidate map size after panel toggle
        setTimeout(() => {
            if (window.map) {
                map.invalidateSize();
            }
        }, 350);
    });
    
    // Handle window resize
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
            mapPanel.classList.remove('collapsed');
        } else {
            // On mobile, keep current state
        }
        updateToggleIcon();
    });
    
    // Ensure button stays visible after fullscreen toggle
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    if (fullscreenBtn) {
        fullscreenBtn.addEventListener('click', function() {
            setTimeout(() => {
                updateToggleIcon();
                // Force button to stay visible
                if (toggleBtn) {
                    toggleBtn.style.display = 'block';
                }
            }, 150);
        });
    }
})();

// Tab switching function
function switchTab(tabName) {
    // Update panel tab buttons
    document.querySelectorAll('.panel-tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Set active for both types
    document.querySelectorAll(`[data-tab="${tabName}"]`).forEach(btn => {
        btn.classList.add('active');
    });
    
    // Update tab content
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    if (tabName === 'fasilitas') {
        document.getElementById('fasilitasTab').classList.add('active');
        // Show regular facilities, hide health facilities
        map.addLayer(markersLayer);
        map.removeLayer(healthMarkersLayer);
        // Set boundary layer opacity to low (tipis)
        if (window.boundariesGeoJSON) {
            window.boundariesGeoJSON.setStyle({fillOpacity: 0.15, opacity: 0.3});
        }
    } else if (tabName === 'kesehatan') {
        document.getElementById('kesehatanTab').classList.add('active');
        // Show health facilities, hide regular facilities
        map.removeLayer(markersLayer);
        map.addLayer(healthMarkersLayer);
        // Set boundary layer opacity to low (tipis)
        if (window.boundariesGeoJSON) {
            window.boundariesGeoJSON.setStyle({fillOpacity: 0.15, opacity: 0.3});
        }
    } else if (tabName === 'administrasi') {
        document.getElementById('administrasiTab').classList.add('active');
        // Hide all facility layers when in admin tab
        map.removeLayer(markersLayer);
        map.removeLayer(healthMarkersLayer);
        // Set boundary layer opacity to normal (full)
        if (window.boundariesGeoJSON) {
            window.boundariesGeoJSON.setStyle({fillOpacity: 0.4, opacity: 0.8});
        }
    }
}